"use strict";!function(){var e=document.getElementById("tbTitle"),t=document.getElementById("tbMarkdown"),n=document.getElementById("preview"),r=new showdown.Converter,i=document.getElementById("btnSave"),o=document.querySelector(".icon-add"),u=document.querySelector(".list"),c={},a=function(){t.addEventListener("keyup",function(){l()}),u.addEventListener("click",function(e){var t=e.target;if(t.matches(".icon-delete")){var n=t.parentNode,r=parseInt(n.getAttribute("data-id"));MKDB.delete(r).then(function(){d()})}else t.matches(".title")&&!function(){var e=t.parentNode,n=parseInt(e.getAttribute("data-id"));MKDB.getById(n).then(function(t){Object.assign(c,{id:parseInt(e.getAttribute("data-id"))},t),s()})}()}),o.addEventListener("click",function(e){c={},s(),e.preventDefault()}),i.addEventListener("click",function(){Object.assign(c,{title:e.value,content:t.value}),console.log(c),MKDB.save(c).then(function(){d()}).catch(function(e){console.log(e)})})},d=function(){window.MKDB.getAll().then(function(e){var t=document.createDocumentFragment();e.forEach(function(e){var n=document.createElement("li");n.innerHTML='<a href="#" class="title">'+e.title+'</a><div class="btn-delete icon-delete">',n.setAttribute("data-id",e.id),t.appendChild(n)}),u.innerHTML="",u.appendChild(t),console.log(e)})},s=function(){var n=c,r=n.title,i=void 0===r?"":r,o=n.content,u=void 0===o?"":o;e.value=i,t.value=u,l()},l=function(){var e=f(t.value);n.innerHTML=e},f=function(e){return r.makeHtml(e)};a(),document.addEventListener("DOMContentLoaded",function(){d()})}(),function(e){var t=e.indexedDB,n="mkeditor",r="artical",i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise(function(i,o){var u=t.open(n,e);u.addEventListener("error",function(e){o(e.target.error)}),u.addEventListener("success",function(e){i(e.target.result)}),u.addEventListener("upgradeneeded",function(e){var t=e.target.result;t.objectStoreNames.contains(r)||t.createObjectStore(r,{keyPath:"id",autoIncrement:!0})})})},o=function(e){return new Promise(function(t,n){var r=e();r.addEventListener("error",function(e){n(e.target.error)}),r.addEventListener("success",function(e){t(e.target.result)})})},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"readonly";return i().then(function(t){return t.transaction(r,e).objectStore(r)})},c=function(e){return u("readwrite").then(function(t){return o(function(){return t.add(e)})})},a=function(e){var t=e.id;return t?u("readwrite").then(function(n){return o(function(){return n.get(t)}).then(function(r){return r?(Object.assign(r,e),o(function(){return n.put(r)})):Promise.reject(new Error("item with id "+t+" not found"))})}):c(e)},d=function(){return u().then(function(e){return new Promise(function(t,n){var r=e.openCursor(),i=[];r.addEventListener("success",function(e){var n=e.target.result;return n?(i.push(n.value),void n.continue()):t(i)}),r.addEventListener("error",function(e){n(e.target.error)})})})},s=function(e){return u().then(function(t){return o(function(){return t.get(e)})})},l=function(e){return u("readwrite").then(function(t){return o(function(){return t.delete(e)})})};e.MKDB={save:a,getAll:d,getById:s,delete:l}}(window);